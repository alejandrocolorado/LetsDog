<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Animate a point</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css" rel="stylesheet" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/5.1.5/turf.js" integrity="sha256-YcmHZHyXpKYagiKb3z5qKGALna6dDVK4NP+4GTOzh6k=" crossorigin="anonymous"></script>
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>
<script>

    mapboxgl.accessToken = 'pk.eyJ1IjoicHVpZ21hciIsImEiOiJja2Q1cTRjMHoyOWc1MzBwZzUxNnBqZjgzIn0.Dl_LIKPYzM72_QZAE0wZWQ';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [0, 0],
        zoom: 2
    });


    function getPointData(lngLat) {
        return {
            'type': 'Point',
            'coordinates': [lngLat.coords.longitude, lngLat.coords.latitude]
        };
    }

    map.on('load', function() {

        var startPos;
        var latitude;
        var longitude;
        var coordsClick;
        
        navigator.geolocation.getCurrentPosition(
            function(position) {

                startPos = position;
                coordsClick = getPointData(startPos)

                map.addSource('point_source', {
                    'type': 'geojson',
                    'data': coordsClick
                });

                map.addLayer({
                    'id': 'point',
                    'source': 'point_source',
                    'type': 'circle',
                    'paint': {
                        'circle-radius': 10,
                        'circle-color': '#007cbf'
                    }
                });

            }, function(error) {
                alert('Error occurred. Error code: ' + error.code);
            }
        );

        navigator.geolocation.watchPosition(
            function(position) {
                
                console.log('new position: ',position.coords)

                map.getSource('point_source').setData({
                    "type": "FeatureCollection",
                    "features": [{
                        "type": "Feature",
                        "properties": {},
                        "geometry": {
                            "type": "Point",
                            "coordinates": [ position.coords.longitude, position.coords.latitude ]
                        }
                    }]
                });

                map.flyTo({
                    center: [
                        position.coords.longitude,
                        position.coords.latitude
                    ],
                    speed: 0.5
                });
        }
    );
        
})

</script>

</body>
</html>
share  improve this answer  